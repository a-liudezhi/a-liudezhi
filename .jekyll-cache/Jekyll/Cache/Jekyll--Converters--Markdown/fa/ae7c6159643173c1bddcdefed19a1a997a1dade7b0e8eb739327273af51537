I"Á><h2 id="å‰è¨€">å‰è¨€</h2>

<p>å¾ˆå¤šäººé‡‡ç”¨<a href="https://pages.github.com/">Github Pages</a>åˆ›å»ºäº†è‡ªå·±çš„blogæˆ–å…¶å®ƒç½‘ç«™ï¼Œè€Œæƒ³åˆ°æ·»åŠ ä¸ªç•™è¨€åŠŸèƒ½ã€‚</p>

<p>é’ˆå¯¹è¿™ä¸ªé—®é¢˜ï¼Œæˆ‘æ·»åŠ äº†<a href="https://github.com/gitalk/gitalk">Gitalk</a> è¯„è®ºæ’ä»¶ã€‚åœ¨æ­¤ï¼Œéå¸¸æ„Ÿè°¢ <a href="https://github.com/FeDemo">@FeDemo</a> çš„æ¨è ã€‚</p>

<h2 id="æ­£æ–‡">æ­£æ–‡</h2>

<h3 id="gitalk-è¯„è®ºæ’ä»¶">Gitalk è¯„è®ºæ’ä»¶</h3>

<p>gitalk ä½¿ç”¨ Github å¸å·ç™»å½•ï¼Œç•Œé¢å¹²å‡€æ•´æ´ï¼Œæœ€å–œæ¬¢çš„ä¸€ç‚¹æ˜¯æ”¯æŒ <code class="highlighter-rouge">MarkDownè¯­æ³•</code>ã€‚</p>

<h3 id="åŸç†">åŸç†</h3>

<p>Gitalk æ˜¯ä¸€ä¸ªåˆ©ç”¨ Github API,åŸºäº Github issue å’Œ Preact å¼€å‘çš„è¯„è®ºæ’ä»¶ï¼Œå¯ä»¥çœ‹åˆ°åœ¨ gitalk çš„è¯„è®ºæ¡†è¿›è¡Œè¯„è®ºæ—¶ï¼Œå…¶å®å°±æ˜¯åœ¨å¯¹åº”çš„ issue ä¸Šæé—®é¢˜ã€‚</p>

<h3 id="è‡ªåŠ¨åˆå§‹åŒ–-gitalk-è¯„è®º">è‡ªåŠ¨åˆå§‹åŒ– Gitalk è¯„è®º</h3>

<p><code class="highlighter-rouge">è·å¾—æƒé™</code>
åœ¨ä½¿ç”¨è¯¥è„šæœ¬ä¹‹å‰é¦–å…ˆè¦åœ¨ GitHub åˆ›å»ºä¸€ä¸ªæ–°çš„ Personal access tokens ï¼Œ<a href="https://github.com/settings/tokens/new">ç‚¹è¿™é‡Œç”³è¯·</a>åœ¨å½“å‰çš„é¡µé¢ä¸­ä¸º Token æ·»åŠ æ‰€æœ‰ <code class="highlighter-rouge">Repo</code> çš„æƒé™ï¼š</p>

<p><code class="highlighter-rouge">personal-access-token</code></p>
<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>New personal access token
Personal access tokens function like ordinary OAuth access tokens. They can be used instead of a password for Git over HTTPS, or can be used to authenticate to the API over Basic Authentication.

Note
Description
Whatâ€™s this token for?

Select scopes
Scopes define the access for personal tokens. Read more about OAuth scopes.

  repo  Full control of private repositories
  repo:status  Access commit status
  repo_deployment  Access deployment status
  public_repo  Access public repositories
  repo:invite  Access repository invitations
</code></pre></div></div>
<p>åœ¨ <code class="highlighter-rouge">repo</code> å‰æ‰“ä¸Šé’©,ç‚¹å‡»ç•Œé¢æœ€ä¸‹çš„é¢<code class="highlighter-rouge">Generate token</code>æŒ‰é’®è·å¾—ä¸€ä¸ªæ–°çš„ <code class="highlighter-rouge">token</code>ï¼š</p>

<p>ä½œè€…å·²ç»æŠŠè¿™ä¸ª <code class="highlighter-rouge">token</code> åˆ æ‰äº†ï¼Œä¸è¦æƒ³ç€ç”¨è¿™ä¸ª <code class="highlighter-rouge">token </code>å°±èƒ½è·å¾—åˆ°ä½œè€… GitHub çš„æƒé™ã€‚</p>

<p><strong>è‡ªåŠ¨åŒ–è„šæœ¬</strong></p>

<p>æœ¬æ–‡ä¸­æä¾›çš„è‡ªåŠ¨åŒ–è„šæœ¬ä½¿ç”¨çš„æ˜¯ <code class="highlighter-rouge">Ruby</code> ä»£ç ï¼Œè¯·ç¡®å®šè‡ªå·±çš„æœºå™¨ä¸Šå·²ç»å®‰è£…äº† <code class="highlighter-rouge">Ruby</code>ï¼Œå¹¶ä¸”ä½¿ç”¨å¦‚ä¸‹çš„å‘½ä»¤å®‰è£…è„šæœ¬æ‰€éœ€è¦çš„æ‰€æœ‰ä¾èµ–ï¼š</p>

<p><code class="highlighter-rouge">sudo gem install faraday activesupport sitemap-parser</code></p>

<p><strong>ä½¿ç”¨ sitemap æ–‡ä»¶</strong></p>

<p>å¦‚æœæˆ‘ä»¬ä½¿ç”¨çš„åšå®¢æœåŠ¡æ˜¯ <code class="highlighter-rouge">Jekyll</code>ï¼Œé‚£ä¹ˆå°±å¯ä»¥é€šè¿‡ <code class="highlighter-rouge">jekyll-sitemap</code> æ’ä»¶ä¸ºåšå®¢åˆ›å»ºå¯¹åº”çš„ <code class="highlighter-rouge">sitemap</code> æ–‡ä»¶ï¼Œä¾‹å¦‚ï¼šhttps://a-liudezhi.github.io/sitemap.xmlã€‚</p>

<p>æœ‰ <code class="highlighter-rouge">sitemap</code> æ–‡ä»¶ä¹‹åå°±éå¸¸å¥½åŠäº†ï¼Œåœ¨ä»»æ„ç›®å½•ä¸‹åˆ›å»º <code class="highlighter-rouge">comment.rb</code> æ–‡ä»¶åï¼Œå°†ä¸‹é¢çš„ä»£ç ç²˜è´´åˆ°æ–‡ä»¶ä¸­ï¼š</p>
<div class="language-js highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nx">username</span> <span class="o">=</span> <span class="dl">"</span><span class="s2">xxxxxxx</span><span class="dl">"</span> <span class="err">#</span> <span class="nx">GitHub</span> <span class="err">ç”¨æˆ·å</span>
<span class="nx">new_token</span> <span class="o">=</span> <span class="dl">"</span><span class="s2">xxxxxxx</span><span class="dl">"</span>  <span class="err">#</span> <span class="nx">GitHub</span> <span class="nx">Token</span>
<span class="nx">repo_name</span> <span class="o">=</span> <span class="dl">"</span><span class="s2">github-comments-repo</span><span class="dl">"</span> <span class="err">#</span> <span class="err">å­˜æ”¾</span> <span class="nx">issues</span>
<span class="nx">sitemap_url</span> <span class="o">=</span> <span class="dl">"</span><span class="s2">https://xxxxxx.github.io/sitemap.xml</span><span class="dl">"</span> <span class="err">#</span> <span class="nx">sitemap</span>
<span class="nx">kind</span> <span class="o">=</span> <span class="dl">"</span><span class="s2">Gitalk</span><span class="dl">"</span> <span class="err">#</span> <span class="dl">"</span><span class="s2">Gitalk</span><span class="dl">"</span> <span class="nx">or</span> <span class="dl">"</span><span class="s2">gitment</span><span class="dl">"</span>

<span class="nx">require</span> <span class="dl">'</span><span class="s1">open-uri</span><span class="dl">'</span>
<span class="nx">require</span> <span class="dl">'</span><span class="s1">faraday</span><span class="dl">'</span>
<span class="nx">require</span> <span class="dl">'</span><span class="s1">active_support</span><span class="dl">'</span>
<span class="nx">require</span> <span class="dl">'</span><span class="s1">active_support/core_ext</span><span class="dl">'</span>
<span class="nx">require</span> <span class="dl">'</span><span class="s1">sitemap-parser</span><span class="dl">'</span>

<span class="nx">sitemap</span> <span class="o">=</span> <span class="nx">SitemapParser</span><span class="p">.</span><span class="k">new</span> <span class="nx">sitemap_url</span>
<span class="nx">urls</span> <span class="o">=</span> <span class="nx">sitemap</span><span class="p">.</span><span class="nx">to_a</span>

<span class="nx">conn</span> <span class="o">=</span> <span class="nx">Faraday</span><span class="p">.</span><span class="k">new</span><span class="p">(:</span><span class="nx">url</span> <span class="o">=&gt;</span> <span class="dl">"</span><span class="s2">https://api.github.com/repos/#{username}/#{repo_name}/issues</span><span class="dl">"</span><span class="p">)</span> <span class="k">do</span> <span class="o">|</span><span class="nx">conn</span><span class="o">|</span>
  <span class="nx">conn</span><span class="p">.</span><span class="nx">basic_auth</span><span class="p">(</span><span class="nx">username</span><span class="p">,</span> <span class="nx">token</span><span class="p">)</span>
  <span class="nx">conn</span><span class="p">.</span><span class="nx">adapter</span>  <span class="nx">Faraday</span><span class="p">.</span><span class="nx">default_adapter</span>
<span class="nx">end</span>

<span class="nx">urls</span><span class="p">.</span><span class="nx">each_with_index</span> <span class="k">do</span> <span class="o">|</span><span class="nx">url</span><span class="p">,</span> <span class="nx">index</span><span class="o">|</span>
  <span class="nx">title</span> <span class="o">=</span> <span class="nx">open</span><span class="p">(</span><span class="nx">url</span><span class="p">).</span><span class="nx">read</span><span class="p">.</span><span class="nx">scan</span><span class="p">(</span><span class="sr">/&lt;title&gt;</span><span class="se">(</span><span class="sr">.*</span><span class="se">?)</span><span class="sr">&lt;</span><span class="se">\/</span><span class="sr">title&gt;/</span><span class="p">).</span><span class="nx">first</span><span class="p">.</span><span class="nx">first</span><span class="p">.</span><span class="nx">force_encoding</span><span class="p">(</span><span class="dl">'</span><span class="s1">UTF-8</span><span class="dl">'</span><span class="p">)</span>
  <span class="nx">response</span> <span class="o">=</span> <span class="nx">conn</span><span class="p">.</span><span class="nx">post</span> <span class="k">do</span> <span class="o">|</span><span class="nx">req</span><span class="o">|</span>
    <span class="nx">req</span><span class="p">.</span><span class="nx">body</span> <span class="o">=</span> <span class="p">{</span> <span class="na">body</span><span class="p">:</span> <span class="nx">url</span><span class="p">,</span> <span class="na">labels</span><span class="p">:</span> <span class="p">[</span><span class="nx">kind</span><span class="p">,</span> <span class="nx">url</span><span class="p">],</span> <span class="na">title</span><span class="p">:</span> <span class="nx">title</span> <span class="p">}.</span><span class="nx">to_json</span>
  <span class="nx">end</span>
  <span class="nx">puts</span> <span class="nx">response</span><span class="p">.</span><span class="nx">body</span>
  <span class="nx">sleep</span> <span class="mi">15</span> <span class="k">if</span> <span class="nx">index</span> <span class="o">%</span> <span class="mi">20</span> <span class="o">==</span> <span class="mi">0</span>
<span class="nx">end</span>
</code></pre></div></div>
<p>åœ¨è¿™é‡Œæœ‰ 5 ä¸ªé…ç½®é¡¹ï¼Œåˆ†åˆ«æ˜¯ GitHub ç”¨æˆ·åã€åœ¨ä¸Šä¸€æ­¥è·å¾—çš„ Tokenã€å­˜æ”¾ issues çš„ä»“åº“ã€sitemap çš„åœ°å€ä»¥åŠæœ€åä½ åœ¨åšå®¢ä¸­ä½¿ç”¨äº†å“ªä¸ªè¯„è®ºæ’ä»¶ï¼Œä¸åŒçš„æ’ä»¶æ‹¥æœ‰æ ‡ç­¾ï¼Œå¯ä»¥é€‰æ‹© â€œGitalkâ€</p>

<p><strong>å°†è¿™æ®µä»£ç æ’å…¥åˆ°ä½ çš„ç½‘ç«™ï¼š</strong></p>
<div class="language-js highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c">&lt;!--</span> <span class="nx">Gitalk</span> <span class="err">è¯„è®º</span> <span class="nx">start</span>  <span class="o">--&gt;</span>

<span class="c">&lt;!--</span> <span class="nx">Gitalk</span> <span class="nx">link</span> <span class="err">çš„æ”¯æŒæ–‡ä»¶</span><span class="o">--&gt;</span>
<span class="o">&lt;</span><span class="nx">link</span> <span class="nx">rel</span><span class="o">=</span><span class="dl">"</span><span class="s2">stylesheet</span><span class="dl">"</span> <span class="nx">href</span><span class="o">=</span><span class="dl">"</span><span class="s2">https://unpkg.com/gitalk/dist/gitalk.css</span><span class="dl">"</span><span class="o">&gt;</span>
<span class="o">&lt;</span><span class="nx">script</span> <span class="nx">src</span><span class="o">=</span><span class="dl">"</span><span class="s2">https://unpkg.com/gitalk@latest/dist/gitalk.min.js</span><span class="dl">"</span><span class="o">&gt;&lt;</span><span class="sr">/script</span><span class="err">&gt;
</span>
<span class="o">&lt;</span><span class="nx">div</span> <span class="nx">id</span><span class="o">=</span><span class="dl">"</span><span class="s2">gitalk-container</span><span class="dl">"</span><span class="o">&gt;&lt;</span><span class="sr">/div</span><span class="err">&gt;
</span>    <span class="o">&lt;</span><span class="nx">script</span> <span class="nx">type</span><span class="o">=</span><span class="dl">"</span><span class="s2">text/javascript</span><span class="dl">"</span><span class="o">&gt;</span>
    <span class="kd">var</span> <span class="nx">gitalk</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">Gitalk</span><span class="p">({</span>
    <span class="na">clientID</span><span class="p">:</span> <span class="dl">'</span><span class="s1">Github Application clientID</span><span class="dl">'</span><span class="p">,</span>
    <span class="na">clientSecret</span><span class="p">:</span> <span class="dl">'</span><span class="s1">Github Application clientSecret</span><span class="dl">'</span><span class="p">,</span>
    <span class="na">repo</span><span class="p">:</span> <span class="dl">'</span><span class="s1">å­˜å‚¨ä½ è¯„è®º issue çš„ Github ä»“åº“å</span><span class="dl">'</span><span class="p">,</span>
    <span class="na">owner</span><span class="p">:</span> <span class="dl">'</span><span class="s1">{Github ç”¨æˆ·å</span><span class="dl">'</span><span class="p">,</span>
    <span class="na">admin</span><span class="p">:</span> <span class="p">[</span><span class="dl">'</span><span class="s1">Github ç”¨æˆ·å</span><span class="dl">'</span><span class="p">],</span>
    <span class="na">id</span><span class="p">:</span> <span class="nb">window</span><span class="p">.</span><span class="nx">location</span><span class="p">.</span><span class="nx">pathname</span><span class="p">,</span> <span class="cm">/*é¡µé¢çš„å”¯ä¸€æ ‡è¯†ï¼Œé•¿åº¦å¿…é¡»å°äº50ï¼Œgitalkä¼šæ ¹æ®è¿™ä¸ªæ ‡è¯†è‡ªåŠ¨åˆ›å»ºå¯¹åº”çš„issueçš„æ ‡ç­¾ï¼Œä½ æ€»ä¸èƒ½å•¥é¡µé¢ä¸‹é¢éƒ½æ˜¯åŒä¸€ä¸ªè¯„è®ºå§*/</span>
    <span class="p">});</span>
    <span class="nx">gitalk</span><span class="p">.</span><span class="nx">render</span><span class="p">(</span><span class="dl">'</span><span class="s1">gitalk-container</span><span class="dl">'</span><span class="p">);</span>
<span class="o">&lt;</span><span class="sr">/script</span><span class="err">&gt;
</span>
<span class="c">&lt;!--</span> <span class="nx">Gitalk</span> <span class="nx">end</span> <span class="o">--&gt;</span>
</code></pre></div></div>
<p><strong>é…ç½®å‚æ•°ï¼š</strong></p>
<div class="language-js highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nx">clientID</span><span class="p">:</span> <span class="s2">`Github Application clientID`</span><span class="p">,</span>
<span class="nx">clientSecret</span><span class="p">:</span> <span class="s2">`Github Application clientSecret`</span><span class="p">,</span>
<span class="nx">repo</span><span class="p">:</span> <span class="s2">`Github ä»“åº“å`</span><span class="p">,</span><span class="c1">//å­˜å‚¨ä½ è¯„è®º issue çš„ Github ä»“åº“åï¼ˆå»ºè®®ç›´æ¥ç”¨ GitHub Page çš„ä»“åº“åï¼‰</span>
<span class="nx">owner</span><span class="p">:</span> <span class="dl">'</span><span class="s1">Github ç”¨æˆ·å</span><span class="dl">'</span><span class="p">,</span>
<span class="nx">admin</span><span class="p">:</span> <span class="p">[</span><span class="dl">'</span><span class="s1">Github ç”¨æˆ·å</span><span class="dl">'</span><span class="p">],</span> <span class="c1">//è¿™ä¸ªä»“åº“çš„ç®¡ç†å‘˜ï¼Œå¯ä»¥æœ‰å¤šä¸ªï¼Œç”¨æ•°ç»„è¡¨ç¤ºï¼Œä¸€èˆ¬å†™è‡ªå·±,</span>
<span class="nx">id</span><span class="p">:</span> <span class="dl">'</span><span class="s1">window.location.pathname</span><span class="dl">'</span><span class="p">,</span> <span class="c1">//é¡µé¢çš„å”¯ä¸€æ ‡è¯†ï¼Œgitalk ä¼šæ ¹æ®è¿™ä¸ªæ ‡è¯†è‡ªåŠ¨åˆ›å»ºçš„issueçš„æ ‡ç­¾,æˆ‘ä»¬ä½¿ç”¨é¡µé¢çš„ç›¸å¯¹è·¯å¾„ä½œä¸ºæ ‡è¯†</span>
</code></pre></div></div>
<p>ä¸Šé¢ç”¨åˆ°å¾ˆå¤šå‚æ•°ï¼Œè¿™äº›å‚æ•°æ­£å¸¸æ¥è¯´ï¼Œæ”¾åˆ° <code class="highlighter-rouge">_config.yaml</code> é‡Œé¢é…ç½®æ¯”è¾ƒå¥½ï¼Œ åç»­ä¿®æ”¹ï¼Œåˆ™ä¸éœ€è¦å»æ”¹ä»£ç ã€‚</p>

<p>å½“ç„¶ï¼Œè¿˜æœ‰å…¶ä»–å¾ˆå¤šå‚æ•°ï¼Œæœ‰å…´è¶£çš„è¯å¯ä»¥ <a href="https://github.com/gitalk/gitalk#options"> ç‚¹è¿™é‡Œ</a>ã€‚</p>

<p>æ¯”å¦‚æˆ‘å°±å¢åŠ äº†è¿™ä¸ªå…¨å±é®ç½©çš„å‚æ•°ã€‚</p>
<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>distractionFreeMode: true,
</code></pre></div></div>
<h3 id="åˆ›å»º-github-application">åˆ›å»º Github Application</h3>

<p>Gitalk éœ€è¦ä¸€ä¸ª <strong>Github Application</strong>ï¼Œ<a href="https://github.com/settings/applications/new">ç‚¹å‡»è¿™é‡Œç”³è¯·</a>ã€‚</p>

<p>å…¶ä¸­,<code class="highlighter-rouge">Application name</code>,<code class="highlighter-rouge">description</code>å¯ä»¥éšä¾¿å¡«ï¼Œ<code class="highlighter-rouge">Homepage URL</code>,<code class="highlighter-rouge">Authorization callback URL</code> éœ€è¦å¡«å†™ä½ åšå®¢ç½‘é¡µçš„ç½‘å€</p>

<p>ç‚¹å‡»åˆ›å»º</p>

<p>è·å– <code class="highlighter-rouge">Client ID</code> å’Œ <code class="highlighter-rouge">Client Secret</code> å¡«å…¥ä½ çš„ Gitalk å‚æ•°ä¸­</p>

<p>å½“ä½ å‚æ•°éƒ½è®¾ç½®å¥½ï¼Œå°†ä»£ç æ¨é€åˆ° <code class="highlighter-rouge">Github</code> ä»“åº“åï¼Œ<code class="highlighter-rouge">åˆ·æ–°å‡ æ¬¡é¡µé¢</code>ï¼Œå°±ä¼šçœ‹åˆ°è¯„è®ºæ’ä»¶ã€‚åˆæ¬¡è¦ç”¨ github å¸å·ç™»å½•ï¼ˆç®¡ç†å‘˜ï¼‰ï¼Œ<code class="highlighter-rouge">åˆæ¬¡éœ€è¦æˆæƒ</code>ï¼š</p>

<p>img/post-shouquan.png</p>

<h1 id="ç»“è¯­">ç»“è¯­</h1>

<p>å‚è€ƒ: <a href="https://draveness.me/git-comments-initialize">è‡ªåŠ¨åˆå§‹åŒ– Gitalk å’Œ Gitment è¯„è®º</a></p>

<p>æœ€åï¼Œ<a href="https://github.com/a-liudezhi/a-liudezhi.github.io">ç»™ä¸ª star å§</a>~</p>
:ET